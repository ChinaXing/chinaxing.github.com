---
layout: tech-post
title: Java Spring 框架和java web开发
category: Java
change_frequency: monthly
tag: spring,aop,di,ioc,web
---

<p>
本文主要记录我学习java的web开发和spring框架时对一些关键技术和概念的理解与记录。
</p>
<p>
<code>待深入</code>
</p>

<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">web开发</a>
<ul>
<li><a href="#sec-1-1">web服务模型</a></li>
<li><a href="#sec-1-2">MVC</a></li>
</ul>
</li>
<li><a href="#sec-2">web框架</a>
<ul>
<li><a href="#sec-2-1">位置与作用</a></li>
<li><a href="#sec-2-2">webapp</a></li>
</ul>
</li>
<li><a href="#sec-3">Spring 框架</a>
<ul>
<li><a href="#sec-3-1">spring是什么</a></li>
<li><a href="#sec-3-2">结构</a></li>
<li><a href="#sec-3-3">spring mvc</a></li>
</ul>
</li>
<li><a href="#sec-4">DI &ndash; 依赖注入</a>
<ul>
<li><a href="#sec-4-1">Dependecy inject</a></li>
<li><a href="#sec-4-2">spring Di</a></li>
</ul>
</li>
<li><a href="#sec-5">Ioc &ndash; 控制反转</a>
<ul>
<li><a href="#sec-5-1">Inverse of Control</a></li>
</ul>
</li>
<li><a href="#sec-6">AOP &ndash; 切面编程</a>
<ul>
<li><a href="#sec-6-1">AOP概念组成</a></li>
<li><a href="#sec-6-2">AOP的用途</a></li>
<li><a href="#sec-6-3">AOP的实现方式</a></li>
<li><a href="#sec-6-4">Spring AOP</a></li>
<li><a href="#sec-6-5">AspectJ</a></li>
</ul>
</li>
<li><a href="#sec-7">参考资源</a></li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-3">
<h3 id="sec-1">web开发</h3>
<div class="outline-text-3" id="text-1">


</div>

<div id="outline-container-1-1" class="outline-4">
<h4 id="sec-1-1">web服务模型</h4>
<div class="outline-text-4" id="text-1-1">

<p>    Web服务模型概括为client/server模型，在server端，又可以有如下的模型：
</p>

<p>
    <img src="../../images/web-server-model.png"  alt="../../images/web-server-model.png" />
</p>
<ul>
<li>request：一个http/https协议的请求
</li>
<li>请求分析处理：<br/>
<ul>
<li>根据HTTP/HTTPs协议获取请求的含义，进入具体的执行逻辑
</li>
<li>调用具体业务逻辑处理模块的代码获取所需的数据和资源
</li>
<li>组装资源，最后生成HTTP响应给客户端      
</li>
</ul>

</li>
<li>业务逻辑处理<br/>
<ul>
<li>业务逻辑通常与具体的业务系统相关
</li>
<li>如果与周边系统相关，可能会进行RPC调用
</li>
</ul>

</li>
<li>数据库和外部系统调用<br/>
      一般的服务都不仅仅是静态资源的获取，意味着动态内容的生成，这时候就需要从数据库查询或写入数据，或者调用外部系统获取数据。
</li>
</ul>


</div>

</div>

<div id="outline-container-1-2" class="outline-4">
<h4 id="sec-1-2">MVC</h4>
<div class="outline-text-4" id="text-1-2">

<p>    MVC 是一种web设计的模式，将web服务拆分为3个模块：M（model），V（view），C（controller）。这种拆分是为了代码重用和解耦，提高灵活性。
</p><ul>
<li>Model ：代指数据获取，包括从数据库、缓冲系统、文件系统获取数据。
</li>
<li>View  ：代指展现，包括返回给client的数据格式，html页面的样式和排版等，负责结果的展现。
</li>
<li>Controller：代指对请求处理和生成响应（数据）的过程，包括请求的解析，获取和计算数据，生成响应数据。
</li>
</ul>


<p>
    在MVC的模型下，一个请求的处理过程如下：
</p>

<p>
    <img src="../../images/web-mvc-model.png"  alt="../../images/web-mvc-model.png" />
</p>
<ul>
<li>请求被controller接到
</li>
<li>controller解析请求的含义
</li>
<li>从model获取数据
</li>
<li>从view获取展现格式/模板
</li>
<li>组装model数据与view生成响应（response）。
</li>
</ul>


<p>    
    业务逻辑代码的最终目标是为请求产生数据，通常作为model的后端。
</p></div>
</div>

</div>

<div id="outline-container-2" class="outline-3">
<h3 id="sec-2">web框架</h3>
<div class="outline-text-3" id="text-2">

<p>   在今天，web开发离不开web框架，web框架的好坏直接决定了web开发的质量和web服务的质量。
</p>
</div>

<div id="outline-container-2-1" class="outline-4">
<h4 id="sec-2-1">位置与作用</h4>
<div class="outline-text-4" id="text-2-1">

<p>    web 框架是运行于webserver内的一个容器，在这个容器里面运行着webapp。<br/>
    web框架的作用是为web应用的开发提供一个环境，web应用的开发者只需要对此容易进行配置和使用，便可以完成许多web开发共性的需求，从而让web开发者将精力集中于web应用的开发上来。
</p>
<p>
    web框架是MVC的实现者，web框架实现了MVC模型，约定了一定的目录结构，用于存放不同类型的文件和资源，web开发者使用web框架就需要遵循这样的约定。
</p>
<p>
    web框架都完成了哪些功能？
</p><ul>
<li>请求的解析
</li>
<li>请求交给到具体的controller或具体的处理函数或模块
</li>
<li>用户代码执行完成后进行响应的组装生成
</li>
<li>发送响应或异常给客户端
</li>
<li>访问控制ACL
</li>
<li>会话（session）的存取
</li>
</ul>


</div>

</div>

<div id="outline-container-2-2" class="outline-4">
<h4 id="sec-2-2">webapp</h4>
<div class="outline-text-4" id="text-2-2">

<p>    web app是运行于web框架中的一段代码或类，实现上web app的代码一般继承web框架的某个类，实现具体的针对性的处理。<br/>
    web app只关心请求的含义，即请求的业务逻辑层面的处理，通过各种途径和方式取得客户端希望的结果数据，然后返回给web框架。
</p></div>
</div>

</div>

<div id="outline-container-3" class="outline-3">
<h3 id="sec-3">Spring 框架</h3>
<div class="outline-text-3" id="text-3">


</div>

<div id="outline-container-3-1" class="outline-4">
<h4 id="sec-3-1">spring是什么</h4>
<div class="outline-text-4" id="text-3-1">

<p>    Spring 是一个用java开发的轻量级web框架，使用di和aop技术构建。<br/>
    spring 可打包为一个jar包，也可以使用其各个子包的形式。
</p></div>

</div>

<div id="outline-container-3-2" class="outline-4">
<h4 id="sec-3-2">结构</h4>
<div class="outline-text-4" id="text-3-2">

<p>    spring的结构如下：<br/>
    <img src="../../images/spring_framework.gif"  alt="../../images/spring_framework.gif" />
</p></div>

</div>

<div id="outline-container-3-3" class="outline-4">
<h4 id="sec-3-3">spring mvc</h4>
<div class="outline-text-4" id="text-3-3">

<p>    spring mvc是对mvc模型的实现其一次请求处理过程如下：<br/>
    <img src="../../images/spring-mvc-recquest-flow.jpg"  alt="../../images/spring-mvc-recquest-flow.jpg" />
</p></div>
</div>

</div>

<div id="outline-container-4" class="outline-3">
<h3 id="sec-4">DI &ndash; 依赖注入</h3>
<div class="outline-text-3" id="text-4">

<p>   依赖注入是一种解耦方法，spring中的依赖注入通过定义XML方式来完成，大体思想是通过在XML中定义类之间的关系（如类A中有一个类B的属性），从而将这种具体的依赖关系剥离在代码外面。<br/>
   然后在加载类的时候根据XML中的定义，将被依赖类注入到依赖者当中。
</p>
</div>

<div id="outline-container-4-1" class="outline-4">
<h4 id="sec-4-1">Dependecy inject</h4>
<div class="outline-text-4" id="text-4-1">

<p>    依赖注入是IoC的一种，对于被注入依赖的模块或者说类，它们只知道一个依赖的super class，而不知道具体被注入了什么实现（super class的子类），所以一部分的执行逻辑的控制权是取决于所注入的依赖的模块的。
</p>
</div>

</div>

<div id="outline-container-4-2" class="outline-4">
<h4 id="sec-4-2">spring Di</h4>
<div class="outline-text-4" id="text-4-2">

<p>    spring 支持Di，而且是其最大特点。spring的依赖注入通过定义XML实现依赖关系定义。
</p></div>
</div>

</div>

<div id="outline-container-5" class="outline-3">
<h3 id="sec-5">Ioc &ndash; 控制反转</h3>
<div class="outline-text-3" id="text-5">


</div>

<div id="outline-container-5-1" class="outline-4">
<h4 id="sec-5-1">Inverse of Control</h4>
<div class="outline-text-4" id="text-5-1">

<p>    关于IoC的一个最形象简明的解释是:  "don't call us, we will call you !" 
</p>
<p>    
    在传统的程序中控制权都掌握在一个模块或者函数中，IoC的思想就是将这种控制权交与你是用的别的模块或者函数，由它们来决定一段执行逻辑。
</p>
</div>
</div>

</div>

<div id="outline-container-6" class="outline-3">
<h3 id="sec-6">AOP &ndash; 切面编程</h3>
<div class="outline-text-3" id="text-6">

<p>AOP 最早提出于1997 年: Gregor Kiczales发表了论文《面向侧面的程序设计》（Aspect Oriented Programming）
</p>
<p>
AOP 译为面向切面的编程比较合适，这里的切面是指一个切入点，在这个切入点上进行编程，比如一个切入点可以是进入后台管理前，这个切入点上我们可以进行登录认证这个操作（编程）。
</p>

</div>

<div id="outline-container-6-1" class="outline-4">
<h4 id="sec-6-1">AOP概念组成</h4>
<div class="outline-text-4" id="text-6-1">

<ul>
<li>Joinpoint：拦截点，如某个业务方法。
</li>
<li>Pointcut：Joinpoint的表达式，表示拦截哪些方法。一个Pointcut对应多个Joinpoint。 
</li>
<li>Advice:  要切入的逻辑。
<ul>
<li>Before Advice 在方法前切入。
</li>
<li>After Advice 在方法后切入，抛出异常时也会切入。
</li>
<li>After Returning Advice 在方法返回后切入，抛出异常则不会切入。
</li>
<li>After Throwing Advice 在方法抛出异常时切入。
</li>
<li>Around Advice 在方法执行前后切入，可以中断或忽略原有流程的执行。
</li>
</ul>

</li>
</ul>

</div>

</div>

<div id="outline-container-6-2" class="outline-4">
<h4 id="sec-6-2">AOP的用途</h4>
<div class="outline-text-4" id="text-6-2">

<p>    AOP主要可以用于一些具有公共需求，而与业务逻辑关联性不强的地方，进行解耦合。如：
</p><ul>
<li>认证、授权
</li>
<li>日志记录
</li>
<li>性能监控
</li>
<li>缓冲代理
</li>
</ul>

</div>

</div>

<div id="outline-container-6-3" class="outline-4">
<h4 id="sec-6-3">AOP的实现方式</h4>
<div class="outline-text-4" id="text-6-3">

<p>    AOP实现上可以通过如下技术进行：
</p><ul>
<li>静态字节码生成：编译器切面逻辑进行字节码生成,切入到切入点中。
</li>
<li>动态代理：为每个切入点运行期动态生成代理对象，将切面逻辑放于代理对象中。这里使用了java动态代理技术。
</li>
<li>动态字节码生成：在运行期目标类加载后，生成被切入类的子类，将切面逻辑放置于此子类中。
</li>
<li>自定义类加载器：在运行期目标类加载前，将切入逻辑加入生成的目标字节码中。
</li>
<li>字节码转换：在运行期，加载类前进行拦截，将切面逻辑加入。
</li>
</ul>


</div>

</div>

<div id="outline-container-6-4" class="outline-4">
<h4 id="sec-6-4">Spring AOP</h4>
<div class="outline-text-4" id="text-6-4">

<p>    Spring框架支持一种AOP实现：方法执行切入。实现的方式是动态代理。动态代理不可用时使用动态字节码生成方式。
</p></div>

</div>

<div id="outline-container-6-5" class="outline-4">
<h4 id="sec-6-5">AspectJ</h4>
<div class="outline-text-4" id="text-6-5">

<p>    AspectJ是一个比较成熟和完善（10多年历史）的AOP实现，支持多种切入点和切入方式，支持通过注解（Annotation）和waever（XML定义）方式进行定义。<br/>
    AspectJ需要使用专门的编译辅助工具(AJDT)来编译代码。aspectJ编译工具在eclipse里面集成。
</p>
</div>
</div>

</div>

<div id="outline-container-7" class="outline-3">
<h3 id="sec-7">参考资源</h3>
<div class="outline-text-3" id="text-7">

<ul>
<li>DI  : <a href="http://www.martinfowler.com/articles/injection.html">http://www.martinfowler.com/articles/injection.html</a>
</li>
<li>IoC : <a href="http://martinfowler.com/bliki/InversionOfControl.html">http://martinfowler.com/bliki/InversionOfControl.html</a>
</li>
</ul>

</div>
</div>
