<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width">
    <title>Raspberry Pi 试玩 - The Chinaxing's blog
    </title>
    <link rel="stylesheet" href="/css/styles.css">
    <script type="text/javascript" src="/js/index.js"></script>
  </head>
  <body>
    <header id="header">
      <div id="menu">
        <div id="menu-header"><a id="site-name" href="/">ChinaXing</a><a id="github-icon" style="background-image: url(/lambda.png);" title="View Github profile" href="http://github.com/ChinaXing/"></a></div>
        <ul id="menu-list">
          <li><a href="/CS-Arch/index.html">CS-Arch<sup>4</sup></a></li>
          <li><a href="/DS-Al/index.html">DS-Al<sup>1</sup></a></li>
          <li><a href="/Haskell/index.html">Haskell<sup>1</sup></a></li>
          <li><a href="/Java/index.html">Java<sup>8</sup></a></li>
          <li><a href="/distribute/index.html">distribute<sup>1</sup></a></li>
          <li><a href="/Perl/index.html">Perl<sup>22</sup></a></li>
          <li><a href="/Postgres/index.html">Postgres<sup>2</sup></a></li>
          <li><a href="/Life/index.html">Life<sup>4</sup></a></li>
          <li class="active"><a href="/Linux/index.html">Linux<sup>26</sup></a></li>
        </ul>
        <!-- vistor map-->
        <div id="clustrmaps-widget"></div>
      </div>
    </header>
    <section id="content">
      <h2 style="text-align:center">Raspberry Pi 试玩
      </h2>
      <div id="toc">Table of Content
        <ol></ol>
      </div>
      <div class="tech">

<p>
<a href="http://www.raspberrypi.org/">Raspberry Pi</a> 是<span class="caps">ARM</span> 处理器搭载Gnu/Debian&nbsp;Linux的单片电脑。它的发行目标是促进青少年学习计算机技术。
</p>
<p> 
<img src="/img/Raspberry-Pi.jpg"  alt="file:///img/Raspberry-Pi.jpg" />
</p>
<p>
Raspberry Pi&nbsp;有早些发布的256M内存/不带网卡的A版本和迟些时候发布的512M内存/带100M网卡的B版本，多数人应该买B版。
</p>
<p>
B版本35$，<span class="caps">RMB325</span>￥。
</p>


<div id="table-of-contents">
<h2>Table of&nbsp;Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">Raspberry Pi&nbsp;构成</a></li>
<li><a href="#sec-2">Raspberry Pi ssh&nbsp;登陆</a></li>
<li><a href="#sec-3">使用远程桌面连接Pi</a></li>
<li><a href="#sec-4">配置Pi连接Internet</a></li>
<li><a href="#sec-5">使用iphone连接Pi</a></li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-3">
<h3 id="sec-1">Raspberry Pi&nbsp;构成</h3>
<div class="outline-text-3" id="text-1">

<p>Raspberry Pi 买到手后，还需要一块<span class="caps">SD</span>卡来作&#8221;硬盘&#8221;，容量需要2GB以上，我买了一块8GB SanDisk的45&nbsp;￥。
</p>
<p>
Raspberry Pi&nbsp;有如下接口：
</p>
<ul>
<li>电源输入：Micro usb接口的5V 1A&nbsp;的输入电流。
</li>
<li>2个<span class="caps">USB</span>接口：可以接鼠标和键盘等。
</li>
<li><span class="caps">HDMI</span>接口：接HDMI接口的显示器，如果是DVI或VGA的，需要买转接线。
</li>
<li>以太网接口：100M的以太网接口，插网线上网用的。
</li>
<li>模拟信号音频和视频输出接口：可以接电视机，输出模拟信号，显示在电视机上。
</li>
<li><span class="caps">SD</span>卡插口：插入SD卡，作存储用。
</li>
</ul>


</div>

</div>

<div id="outline-container-2" class="outline-3">
<h3 id="sec-2">Raspberry Pi ssh&nbsp;登陆</h3>
<div class="outline-text-3" id="text-2">

<p>拿到手后，我由于没有<span class="caps">HDMI</span>的显示器（目前这样显示器还贵，多数还是VGA的便宜LED），也不打算花钱再买，所以打算用ssh登陆试玩。
</p>
<p>
Raspberry Pi在加电后就会自动启动系统，系统中sshd 服务已经配置为随系统启动启动。所以Rapsberry Pi&nbsp;启动后ssh服务就可用了。
</p>
<p>
在连接ssh前我们需要配置Pi的网络，我使用了一根网线连接Pi和我的笔记本，两者组成了一个局域网。
</p>
<p>
为了实现连接，我在我的笔记本Fedora中配置了<span class="caps">DHCP</span>服务，这样Pi启动的时候就可以从DHCP获得IP：
</p>
<ol>
<li>安装dhcp-server&nbsp;在Fedora中：
</li>
</ol>




<pre class="example">sudo yum install dhcp
</pre>

<ol>
<li>配置dhcp：



<pre class="example">sudo vim /etc/dhcp/dhcpd.conf
</pre>

<p>
   添加如下配置：
</p>


<pre class="example">subnet 192.168.33.0 netmask 255.255.255.0 { 
    range 192.168.33.2 192.168.33.114; 
    default-lease-time 86400; 
    max-lease-time 259200; 
    option subnet-mask 255.255.255.0; 
    option broadcast-address 192.168.33.255; 
    option routers 192.168.33.2; 
    option domain-name-servers 192.168.33.2; 
} 
</pre>

</li>
<li>配置与Pi连接的网卡的<span class="caps">IP</span>:



<pre class="example">sudo ifconfig em1 192.168.33.2/24
</pre>

</li>
<li>启动dhcp服务：



<pre class="example">sudo dhcpd
</pre>

</li>
<li>启动Pi,重新加电即可重起Pi。
</li>
<li>查看Pi 的<span class="caps">IP</span>：



<pre class="example">cat /var/lib/dhcpd/dhcpd.lease   
</pre>

<p>
   里面可以看到从dhcpd 获取到<span class="caps">IP</span>的客户端，可以看到服务器带有Pi字样的服务器，就是Pi了。<br/>&nbsp;我的Pi获取的地址是:192.168.33.3
</p></li>
<li>使用ssh 登陆Pi:



<pre class="example">ssh pi@192.168.33.3    
</pre>

<p>
   密码是:*respberry*
</p></li>
<li>登陆后我们可以设置Pi的网络配置，配成静态地址，这样就不需要使用dhcp了。网络配置在/etc/network/interfaces



<pre class="example">auto eth0
#iface eth0 inet dhcp 
iface eth0 inet static
address 192.168.33.3
netmask 255.255.255.0
network 192.168.33.0
broadcast 192.168.33.255
gateway 192.168.33.2
</pre>

</li>
</ol>


</div>

</div>

<div id="outline-container-3" class="outline-3">
<h3 id="sec-3">使用远程桌面连接Pi</h3>
<div class="outline-text-3" id="text-3">

<p>没有显示器，却想看Pi的图形桌面，怎么办？
</p>
<p>
可以使用远程桌面来访问Pi，过程也很简单，我通过iphone也连接到了Pi。
</p>
<ol>
<li>在Pi上安装xrdp, 一个远程桌面的服务端：



<pre class="example">sudo apt-get install xrdp   
</pre>


<p>
   安装好后xrdp就自动启动了，而且配置为随系统启动
</p></li>
<li>在Fedora上安装rdesktop，一个远程桌面客户端：



<pre class="example">sudo yum install rdesktop   
</pre>

</li>
<li>使用Fedora 的Remte Desktop 连接Pi，输入Pi的ip地址和用户名pi，连接后如图：

<p>  
   <img src="/img/Raspberry-Pi-Remote-desktop.png"  alt="file:///img/Raspberry-Pi-Remote-desktop.png" />
</p></li>
</ol>


</div>

</div>

<div id="outline-container-4" class="outline-3">
<h3 id="sec-4">配置Pi连接Internet</h3>
<div class="outline-text-3" id="text-4">

<p>使用一根网线连接Pi和电脑实现了Pi和电脑的互联，Pi却无法连接internet，访问google，baidu等网站，需要作一些配置。
</p>
<p>
我使用iptables来让Fedora作路由器的功能，相当于Pi通过网线连接到了一台局域网的路由器一样。<br/>&nbsp;Fedora当路由器作用，同时作Nat功能，将Pi的地址转换为Fedora连接局域网的网卡的地址（我这里的网卡是无线网卡），因为局域网路由器和Pi不在一个网段。
</p>
<ol>
<li>打开Fedora的ip<sub>forward功能，允许转发从Pi发来的和到达Pi的包，作路由器用</sub>:



<pre class="example">echo 1 | sudo tee /proc/sys/net/ipv4/ip_forward
</pre>


</li>
<li>在Fedora上面添加iptables，实现<span class="caps">SNAT</span>:



<pre class="example">sudo iptables -t nat -A POSTROUTING -j SNAT \
        --to-source 192.168.1.100 --random
</pre>


<p>
   <b>&ndash;random</b> 选项让内核帮我们选源端口<br/>
   <b>192.168.1.100</b>&nbsp;是我连接路由器上网的那个网卡的ip地址，是个无线网卡,接口wlan0
</p></li>
<li>在Pi内部检测网络联通：



<pre class="example">ping www.baidu.com   
</pre>


<p>
   <b>如果没有配置域名服务器</b>&nbsp;需要配置域名解析服务器地址:
</p>


<pre class="example">echo nameserver 8.8.8.8 | sudo tee /etc/resolv.conf
</pre>

</li>
</ol>



<ol>
<li>完成设置后，整个网络数据流如下:<br/>
   Pi ==&gt; internet


<p>
   <img src="/img/raspberry-pi--pi2internet.png"  alt="file:///img/raspberry-pi--pi2internet.png" />
</p>
<p>
   Ineternet ==&gt;&nbsp;Pi
</p>

<p>
   <img src="/img/raspberry-pi--internet2pi.png"  alt="file:///img/raspberry-pi--internet2pi.png" />
</p></li>
</ol>


</div>

</div>

<div id="outline-container-5" class="outline-3">
<h3 id="sec-5">使用iphone连接Pi</h3>
<div class="outline-text-3" id="text-5">

<p>使用iphone连接Pi，需要安装远程桌面客户端在iphone上。
</p>
<p>
由于iphone通过无线路由器接入局域网，和Fedora是同一个网段:192.168.1.0，和Pi是不在一个局域网的（没有物理连接），&nbsp;所以需要通过Fedora的转发来完成iphone到Pi的连接:
</p>


<pre class="example">iphone --&gt; Fedora --&gt; Pi
</pre>

<p>
通过在Fedora上面配置如下iptables完成转发功能：
</p>


<pre class="example">sudo iptables -t nat -A PREROUTING -i wlan0 -p tcp -m tcp \
       --dport 3389 -j DNAT --to-destination 192.168.33.3 
</pre>


<p>
<b>wlan0</b> 是电脑的无线网卡，连接到局域网的无线路由器上网 <br/>
<b>192.168.3.3</b> 是Pi的地址<br/>&nbsp;这句iptables的意思是对访问fedora的3389的连接，<span class="caps">DNAT</span>到Pi的3389端口。
</p>
<p>
配置完成后就可以使用iphone连接到Pi:
</p>
<p>
<img src="/img/Raspberry-Pi-iphone-remote-desktop.jpg"  alt="file:///img/Raspberry-Pi-iphone-remote-desktop.jpg" />
</p>

<p>
Have Fun&nbsp;:)
</p>
</div>
</div>

      </div>
      <!-- Table of Content-->
      <script src="/js/jquery-1.11.1.min.js" charset="utf-8"></script>
      <script src="/js/tableofcontents.js" charset="utf-8"></script>
      <script charset="utf-8">
        $(function(){
          $("#toc>ol").tableOfContents(
           null,
           {
             startLevel: 3,
             depth:3,
             topLinks: "\u21E7",
             topLinkClass: "toc-top-link",
             topBodyId: "toc-top",
          });
        });
        
      </script>
      <!-- Google Plus--><br>
      <!-- Place this tag where you want the +1 button to render.-->
      <div data-size="medium" class="g-plusone"></div>
      <!--google plus-->
      <!-- Place this tag after the last +1 button tag.-->
      <script>
        window.___gcfg = {lang: 'zh-CN'};
        
        (function() {
          var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
          po.src = 'https://apis.google.com/js/plusone.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
        })();
        
        
      </script>
      <!-- DISQUS-->
      <div id="disqus_thread" style="padding-top:1em"></div>
      <script>
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'chinaxing'; // required: replace example with your forum shortname
        
        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
        
      </script>
      <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus</a></noscript><a id="dsq-brlink" href="http://disqus.com">comments powered by<span class="logo-disqus">Disqus</span></a>
    </section>
    <footer>
    </footer>
  </body>
  <!-- google Analytics-->
  <script>
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37422195-1']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <!-- clusterMaps-->
  <script>
    var _clustrmaps = {
     'url' : 'http://chinaxing.org', 
     'user' : 1103575, 
     'server' : '2',
     'id' : 'clustrmaps-widget', 
      'version' : 1, 
     'date' : '2013-07-14',
     'lang' : 'zh',
     'corners' : 'square' 
    };
    (function (){
      var s = document.createElement('script'); 
      s.type = 'text/javascript'; 
      s.async = true; 
      s.src = 'http://www2.clustrmaps.com/counter/map.js'; 
      var x = document.getElementsByTagName('script')[0]; 
      x.parentNode.insertBefore(s, x);})();
  </script>
  <noscript>
    a(href="http://www2.clustrmaps.com/user/f0710d6d7")
      img(src="http://www2.clustrmaps.com/stats/maps-no_clusters/chinaxing.org-thumb.jpg", alt="Locations of visitors to this page")
  </noscript>
</html>