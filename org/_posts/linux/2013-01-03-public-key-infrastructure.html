<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>---</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<meta name="title" content="---"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2013-02-05 15:13:38 CST"/>
<meta name="author" content="chinaxing"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  html { font-family: Times, serif; font-size: 12pt; }
  .title  { text-align: center; }
  .todo   { color: red; }
  .done   { color: green; }
  .tag    { background-color: #add8e6; font-weight:normal }
  .target { }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  {margin-left:auto; margin-right:0px;  text-align:right;}
  .left   {margin-left:0px;  margin-right:auto; text-align:left;}
  .center {margin-left:auto; margin-right:auto; text-align:center;}
  p.verse { margin-left: 3% }
  pre {
	border: 1pt solid #AEBDCC;
	background-color: #F3F5F7;
	padding: 5pt;
	font-family: courier, monospace;
        font-size: 90%;
        overflow:auto;
  }
  table { border-collapse: collapse; }
  td, th { vertical-align: top;  }
  th.right  { text-align:center;  }
  th.left   { text-align:center;   }
  th.center { text-align:center; }
  td.right  { text-align:right;  }
  td.left   { text-align:left;   }
  td.center { text-align:center; }
  dt { font-weight: bold; }
  div.figure { padding: 0.5em; }
  div.figure p { text-align: center; }
  div.inlinetask {
    padding:10px;
    border:2px solid gray;
    margin:10px;
    background: #ffffcc;
  }
  textarea { overflow-x: auto; }
  .linenr { font-size:smaller }
  .code-highlighted {background-color:#ffff00;}
  .org-info-js_info-navigation { border-style:none; }
  #org-info-js_console-label { font-size:10px; font-weight:bold;
                               white-space:nowrap; }
  .org-info-js_search-highlight {background-color:#ffff00; color:#000000;
                                 font-weight:bold; }
  /*]]>*/-->
</style>
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>

</head>
<body>

<div id="preamble">

</div>

<div id="content">
<h1 class="title">---</h1>


---
layout: post
title: 公钥认证体系
category: linux
change_frequency: monthly
tag: ca,digtal-sign
---


<p>
*<a href="http://en.wikipedia.org/wiki/Public_key_infrastructure">Public Key Infrastructure</a>* 目的是进行数字认证
</p>

<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1 构成</a></li>
<li><a href="#sec-2">2 运行过程</a></li>
<li><a href="#sec-3">3 自签名证书</a></li>
<li><a href="#sec-4">4 公钥认证在Web浏览器中应用</a></li>
<li><a href="#sec-5">5 openssl 进行证书的签名过程</a></li>
<li><a href="#sec-6">6 客户端证书</a></li>
<li><a href="#sec-7">7 其它</a></li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-3">
<h3 id="sec-1"><span class="section-number-3">1</span> 构成</h3>
<div class="outline-text-3" id="text-1">

<p>它的各个组成部分如图：
</p>
<p>
<img src="file:///images/Public-Key-Infrastructure.svg"  alt="file:///images/Public-Key-Infrastructure.svg" />
</p>
<ul>
<li>CA：certifacate Authority :权威认证机构，被完全信赖的。
</li>
<li>RA：Regstration Authority :注册机构，执行实际的绑定。
</li>
<li>VA：Validation Authority : 验证机构，根据CA的信息，对用户身份进行验证。
</li>
</ul>


</div>

</div>

<div id="outline-container-2" class="outline-3">
<h3 id="sec-2"><span class="section-number-3">2</span> 运行过程</h3>
<div class="outline-text-3" id="text-2">

<ol>
<li>用户产生自己的public-private key对和自己需要认证的身份信息，提交给RA进行认证(CSR)。
</li>
<li>RA 根据用户提供的信息，确认符合（valid）后，提交与CA，CA对用户信息和公钥进行签名生成证书(Cert)，发给用户。
</li>
<li>用户发布数字产品的时候，对产品使用私钥进行签名，连同CA颁发给自己的证书一同发布。
</li>
<li>客户收到产品和证书，将证书发给VA，请求VA进行验证。
</li>
<li>VA根据证书内容和CA的信息（公钥），判断此证书是CA签发的。告诉客户，该证书有效。
</li>
<li>客户使用证书里面的公钥解密产品，得到用户发布的产品。
</li>
</ol>


</div>

</div>

<div id="outline-container-3" class="outline-3">
<h3 id="sec-3"><span class="section-number-3">3</span> 自签名证书</h3>
<div class="outline-text-3" id="text-3">

<p>是使用自己的私钥进行签名生成的证书。而一般的证书是通过CA的私钥进行签名的。
</p>
<p>
<b>用途</b> : <a href="http://en.wikipedia.org/wiki/Root_certificate">根CA</a> 机构。因为没有更高层的CA来签发的证书(CA分级，低级别的CA由高级别的CA来进行认证)。
</p>
</div>

</div>

<div id="outline-container-4" class="outline-3">
<h3 id="sec-4"><span class="section-number-3">4</span> 公钥认证在Web浏览器中应用</h3>
<div class="outline-text-3" id="text-4">

<p>当使用https协议浏览网站的时候，浏览器和网站服务器之间进行了对服务器身份的认证过程：
</p>
<ol>
<li>服务器将自己的证书和公钥发给浏览器。
</li>
<li>浏览器根据内置的信赖CA列表中找到证书的签发CA，如果没找到，认为证书是不可信赖的，提示用户Dangerous。
</li>
<li>根据证书提供的或者是CA提供的证书有效性验证信息获取地址，获取证书有效性数据（CRL），判断证书是否还有效（Revocation）。如果无效，则同样认为不可信赖。 此步骤使用CRL协议或OCSP协议获取CRL信息。
</li>
<li>证书认证完毕，信息可靠。进入密钥协商过程。
</li>
<li>浏览器选择一个密钥和对称加密算法，使用服务器的公钥进行加密后发给服务器。
</li>
<li>服务器知道了后续通信使用的密钥和算法，之后的通信都使用这个对称加密算法和密钥来对数据加密进行。
</li>
</ol>


<p>
*<a href="http://en.wikipedia.org/wiki/Certificate_revocation_list">CRL</a>*: 
</p>
<p>
 即: certificate revocation list。 是CA生成的用来发布告知哪些被签名的公钥现在是无效的（无效不等于过期）。
</p>
<p>
 一般是用户私钥丢失等，用户主动通知CA标记为无效，类似信用卡密码丢了，卡挂失的道理。  
 CRL使用 http协议来传输(不过为了克服其问题，一般已经使用<a href="http://en.wikipedia.org/wiki/Online_Certificate_Status_Protocol"> OCSP</a> 这个协议来代替它了)， 由浏览器发起，
 chrome里面可以在高级设置-&gt;安全里面进行设置，打开*"Check for server certificate revocation"*, 来让浏览器对每个https域名证书都进行CRL验证。这个选项默认是关闭的。
</p>

</div>

</div>

<div id="outline-container-5" class="outline-3">
<h3 id="sec-5"><span class="section-number-3">5</span> <span class="todo TODO">TODO</span> openssl 进行证书的签名过程</h3>
<div class="outline-text-3" id="text-5">


</div>

</div>

<div id="outline-container-6" class="outline-3">
<h3 id="sec-6"><span class="section-number-3">6</span> <span class="todo TODO">TODO</span> 客户端证书</h3>
<div class="outline-text-3" id="text-6">


</div>

</div>

<div id="outline-container-7" class="outline-3">
<h3 id="sec-7"><span class="section-number-3">7</span> 其它</h3>
<div class="outline-text-3" id="text-7">

<ol>
<li>数字签名中CA/Web browser/developer关系图:  
 <img src="file:///images/Usage-of-Digital-Certificate.svg"  alt="file:///images/Usage-of-Digital-Certificate.svg" />
</li>
<li>CA的Wiki:<a href="http://en.wikipedia.org/wiki/Certificate_authority">http://en.wikipedia.org/wiki/Certificate_authority</a>, 很不错的比较全面的介绍。
</li>
</ol>

</div>
</div>
</div>

<div id="postamble">
<p class="date">Date: 2013-02-05 15:13:38 CST</p>
<p class="author">Author: chinaxing</p>
<p class="creator">Org version 7.8.11 with Emacs version 24</p>
<a href="http://validator.w3.org/check?uri=referer">Validate XHTML 1.0</a>

</div>
</body>
</html>
