---
date: 2014-09-22 22:02:03
template: tech.jade
title: Java debug 介绍
category: Java
chage_frequency: monthly
tag: Java,debug
---
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">overview</a></li>
<li><a href="#sec-2">debug client</a></li>
<li><a href="#sec-3">debug target</a></li>
<li><a href="#sec-4">jdwp</a></li>
<li><a href="#sec-5">Other</a></li>
</ul>
</div>
</div>
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">overview</h2>
<div class="outline-text-2" id="text-1">

<div class="figure">
<p><img src="../../img/jpda.jpg" alt="jpda.jpg" />
</p>
</div>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">debug client</h2>
<div class="outline-text-2" id="text-2">
<p>
jdk 自带的debug工具jdb类似于其他语言如gcc 的 gdb，可以完成命令行模式下进行debug：
</p>

<div class="org-src-container">

<pre class="src src-sh">jdb MainClass args # 启动jvm并进入调试模式（此处会启动2个jvm）
jdb attach $pid # 连接到运行中的jvm
jdb listen $address # listen等待jvm的连接，这个模式比较奇怪，是被调试程序来connect jdb
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">debug target</h2>
<div class="outline-text-2" id="text-3">
<p>
对于被调试程序，即目标jvm，要打开debug服务，才能接收jdb发来的debug请求，这通过java的agent功能来加载debug相关的lib来实现：
</p>
<div class="org-src-container">

<pre class="src src-sh">#使用socket连接来进行jdb的交互(remote debug)
java -agentlib:jdwp=transport=dt_socket,server=y,address=$address 
#使用共享内存模式来进行通信，本机调试
java -agentlib:jdwp=transport=dt_shmem,server=y 
#获取jdwp调试选项的帮助
java -agentlib:jdwp=help
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">jdwp</h2>
<div class="outline-text-2" id="text-4">
<p>
jdwp（Java Debug Wire Protocol）是一个debug的协议，是jdb等client跟jvm将互操作的协议，jdwp的传输(transport)用来指明用什么传输层实现，我们可以通过socket来实现远程调试的目的.
</p>

<p>
jdwp有一个选项:server=y|n 来表达是监听等待debugclient的连接还是去主动连接处于listen状态的debugclient，可以对照上面提到的jdb的listen模式明白它的用处。
</p>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5">Other</h2>
<div class="outline-text-2" id="text-5">
<ol class="org-ol">
<li><a href="http://docs.oracle.com/javase/7/docs/technotes/guides/jpda/">Java Platform Debugger Architecture - JPDA</a> <br  />
   java的debug有一个debug的体系，可以在Oracle的网站上面了解到详细的说明. 这个架构指导如何进行debug的开发，许多IDE的debug功能即采用这里的架构。
</li>
<li>Java Debug Interface - JDI <br  />
   JDI 是属于JPDA的规范，定义了代码级别的调试接口，可以通过实现这些接口实现自己的调试程序。
</li>
<li>Java Virtual Machine Tools Interface - JMTI <br  />
   提供了native方式的接口，可以用来开发调试程序。
</li>
<li>深入java debug 文章 : <a href="http://www.ibm.com/developerworks/cn/views/java/libraryview.jsp?search_by=%E6%B7%B1%E5%85%A5+Java+%E8%B0%83%E8%AF%95%E4%BD%93%E7%B3%BB">深入java调试体系</a>
</li>
</ol>
</div>
</div>
